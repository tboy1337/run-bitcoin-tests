services:
  bitcoin-tests:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bitcoin-cpp-tests
    volumes:
      # Mount the bitcoin source directory for live development
      - ./bitcoin:/bitcoin-source:ro
      # Mount a volume for test results/output persistence
      - bitcoin-test-results:/test-results
    environment:
      - BUILD_TYPE=${BUILD_TYPE:-RelWithDebInfo}
      - TEST_ARGS=${TEST_ARGS:-}
      - VERBOSE=${VERBOSE:-0}
    command: ["/run_tests.sh"]
    # Keep container running for debugging if needed
    stdin_open: true
    tty: true

volumes:
  bitcoin-test-results:
    driver: local